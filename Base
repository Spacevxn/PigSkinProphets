/*
PigSkinProphets.jsx
A single-file React app (default export) implementing a starter marketplace / trade-analyzer UI inspired by KeepTradeCut,
customized for PigSkinProphets — a community-powered fantasy football trade analyzer.

How to use:
- This file is a self-contained React component that can be dropped into a React app (Create React App, Vite, Next.js page, etc.).
- Tailwind CSS is expected to be configured in the host project. If you don't have Tailwind, the layout will still work but some utilities won't apply.
- Recommended packages: framer-motion, lucide-react (optional). Install with: `npm i framer-motion lucide-react`.
- Replace mock data and local-state aggregation with your backend (REST API / Firebase) for persistent, community-driven KTCs.

Features included:
- Header + responsive layout
- Submit a KTC (Keep / Trade / Cut) triple
- Simple aggregation to produce community-driven rankings (mocked locally)
- Trade Analyzer: evaluate a proposed trade vs community values and get guidance
- About page customized for PigSkinProphets

NOTES:
- This is a starter demo. For production: add authentication, persistent DB, image uploads, rate limiting, and input validation.
*/

import React, { useState, useMemo } from 'react';
import { motion } from 'framer-motion';

export default function PigSkinProphetsApp(){
  // Mock players (id, name, position, team)
  const initialPlayers = [
    {id:1,name:'Bijan Robinson', pos:'RB', team:'ATL'},
    {id:2,name:'C.J. Stroud', pos:'QB', team:'HOU'},
    {id:3,name:'Jaxon Smith-Njigba', pos:'WR', team:'SEA'},
    {id:4,name:'Stephen Carr', pos:'RB', team:'LV'},
    {id:5,name:'Rome Odunze', pos:'WR', team:'CHI'},
    {id:6,name:'Brandon Aiyuk', pos:'WR', team:'SF'},
    {id:7,name:'Joe Mixon', pos:'RB', team:'CIN'},
    {id:8,name:'Trevor Lawrence', pos:'QB', team:'JAX'},
  ];

  // Mock KTCs are stored as arrays of {a,b,c, ranking: ['a','b','c']} where values are player ids
  const [players] = useState(initialPlayers);
  const [ktcs, setKtcs] = useState([
    // a few seed KTCs to make the demo interesting
    {ranking:[1,3,2]},
    {ranking:[5,1,3]},
    {ranking:[2,8,6]},
    {ranking:[7,1,4]},
    {ranking:[3,5,6]},
  ]);

  // UI state for KTC submission
  const [choiceA, setChoiceA] = useState(players[0].id);
  const [choiceB, setChoiceB] = useState(players[1].id);
  const [choiceC, setChoiceC] = useState(players[2].id);
  const [message, setMessage] = useState('');

  // Simple pairwise aggregation to compute community scores (Condercet-like count)
  // For each pair (i,j) count how many KTCs ranked i above j.
  const scores = useMemo(()=>{
    // initialize pairwise counts
    const ids = players.map(p=>p.id);
    const pairWins = {};
    ids.forEach(i=>ids.forEach(j=>{ if(i!==j) pairWins[`${i}-${j}`]=0 }));

    ktcs.forEach(k=>{
      const r = k.ranking; // array of ids in order best -> worst
      for(let i=0;i<r.length;i++){
        for(let j=i+1;j<r.length;j++){
          pairWins[`${r[i]}-${r[j]}`]++;
        }
      }
    });

    // score each player by total pairwise wins
    const scoreMap = {};
    ids.forEach(i=>{
      scoreMap[i]=0;
      ids.forEach(j=>{ if(i!==j){
        const wins = pairWins[`${i}-${j}`] || 0;
        const losses = pairWins[`${j}-${i}`] || 0;
        // add normalized margin (wins - losses)
        scoreMap[i] += (wins - losses);
      }})
    });

    return scoreMap; // map from player id -> numeric score (higher better)
  },[ktcs, players]);

  // Produce a ranking array sorted by scores
  const communityRanking = useMemo(()=>{
    const arr = players.map(p=>({...p, score: scores[p.id]||0}));
    arr.sort((a,b)=>b.score - a.score);
    return arr;
  },[players,scores]);

  // Handler: submit a KTC (order matters: keep -> trade -> cut)
  function submitKTC(){
    if(new Set([choiceA,choiceB,choiceC]).size !== 3){
      setMessage('Please pick three different players.');
      return;
    }
    const newKTC = { ranking:[choiceA, choiceB, choiceC] };
    setKtcs(prev=>[...prev, newKTC]);
    setMessage('Thanks! Your KTC was recorded (demo).');
  }

  // Trade analyzer: evaluate proposed trade (you give players out and receive players)
  // Simple logic: sum community scores and advise
  function analyzeTrade(giveIds, receiveIds){
    const giveScore = giveIds.reduce((s,id)=>s + (scores[id]||0), 0);
    const recvScore = receiveIds.reduce((s,id)=>s + (scores[id]||0), 0);
    const diff = recvScore - giveScore; // positive means trade is good for you
    let verdict = 'Even / Depends';
    if(diff > 1) verdict = 'Likely Advantageous';
    else if(diff < -1) verdict = 'Likely Disadvantageous';
    return {giveScore, recvScore, diff, verdict};
  }

  // Small helper to map id -> player
  function findPlayer(id){ return players.find(p=>p.id===id); }

  // Trade analyzer UI state
  const [giveSelection, setGiveSelection] = useState([]);
  const [receiveSelection, setReceiveSelection] = useState([]);
  const [analysisResult, setAnalysisResult] = useState(null);

  function toggleSelect(listSetter, list, id){
    if(list.includes(id)) listSetter(list.filter(x=>x!==id)); else listSetter([...list,id]);
  }

  function runAnalysis(){
    if(giveSelection.length===0 || receiveSelection.length===0){
      setMessage('Pick at least one player to give and one to receive.');
      return;
    }
    const res = analyzeTrade(giveSelection, receiveSelection);
    setAnalysisResult(res);
    setMessage('');
  }

  return (
    <div className="min-h-screen bg-slate-50 text-slate-900">
      <header className="bg-white shadow-sm sticky top-0 z-30">
        <div className="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="w-10 h-10 bg-gradient-to-br from-rose-500 to-pink-500 rounded flex items-center justify-center text-white font-bold">PP</div>
            <div>
              <div className="font-semibold">PigSkinProphets</div>
              <div className="text-xs text-slate-500">Community-powered fantasy trade analyzer</div>
            </div>
          </div>

          <nav className="hidden md:flex items-center gap-4">
            <button className="px-3 py-2 rounded hover:bg-slate-100">Home</button>
            <button className="px-3 py-2 rounded hover:bg-slate-100">Submit KTC</button>
            <button className="px-3 py-2 rounded hover:bg-slate-100">Trade Analyzer</button>
            <button className="px-3 py-2 rounded bg-rose-600 text-white font-medium">Sign in</button>
          </nav>

          <div className="md:hidden">
            <button className="p-2 rounded bg-slate-100">Menu</button>
          </div>
        </div>
      </header>

      <main className="max-w-6xl mx-auto px-4 py-8">
        <section className="grid grid-cols-1 lg:grid-cols-[1fr,360px] gap-8">
          <div>
            <div className="bg-white rounded-2xl p-6 shadow">
              <h1 className="text-2xl font-bold">PigSkinProphets</h1>
              <p className="mt-2 text-slate-700">Community-powered trade values for dynasty and redraft fantasy football. Contribute a quick KTC and unlock rankings that reflect how real managers value players.</p>
            </div>

            <div className="mt-6 grid gap-4 grid-cols-1 sm:grid-cols-2">
              <div className="bg-white p-4 rounded-2xl shadow">
                <h3 className="font-semibold">Community Rankings (demo)</h3>
                <ol className="mt-3 space-y-2 text-sm">
                  {communityRanking.map((p,idx)=> (
                    <li key={p.id} className="flex items-center justify-between">
                      <div><span className="font-medium">{idx+1}. {p.name}</span> <span className="text-xs text-slate-500">({p.pos})</span></div>
                      <div className="text-sm text-slate-700">score: {p.score}</div>
                    </li>
                  ))}
                </ol>
              </div>

              <div className="bg-white p-4 rounded-2xl shadow">
                <h3 className="font-semibold">Submit a KTC</h3>
                <div className="mt-3 space-y-2 text-sm">
                  <label className="block">Keep (best)</label>
                  <select value={choiceA} onChange={e=>setChoiceA(Number(e.target.value))} className="w-full rounded border px-2 py-1">
                    {players.map(p=> <option key={p.id} value={p.id}>{p.name} — {p.pos}</option>)}
                  </select>

                  <label>Trade</label>
                  <select value={choiceB} onChange={e=>setChoiceB(Number(e.target.value))} className="w-full rounded border px-2 py-1">
                    {players.map(p=> <option key={p.id} value={p.id}>{p.name} — {p.pos}</option>)}
                  </select>

                  <label>Cut (worst)</label>
                  <select value={choiceC} onChange={e=>setChoiceC(Number(e.target.value))} className="w-full rounded border px-2 py-1">
                    {players.map(p=> <option key={p.id} value={p.id}>{p.name} — {p.pos}</option>)}
                  </select>

                  <div className="flex gap-2 mt-3">
                    <button onClick={submitKTC} className="px-4 py-2 rounded bg-rose-600 text-white">Submit</button>
                    <button onClick={()=>{ setChoiceA(players[0].id); setChoiceB(players[1].id); setChoiceC(players[2].id); setMessage(''); }} className="px-4 py-2 rounded border">Reset</button>
                  </div>

                  {message && <div className="mt-2 text-xs text-slate-600">{message}</div>}
                </div>
              </div>
            </div>

            <div className="mt-6 bg-white p-4 rounded-2xl shadow">
              <h3 className="font-semibold">About PigSkinProphets</h3>
              <p className="mt-2 text-sm text-slate-700">PigSkinProphets is built for fantasy managers who want trade values based on how the community actually thinks. Contribute by submitting quick Keep/Trade/Cut evaluations and get back dynamic values, trade guidance, and the confidence to win more deals in your league.</p>
            </div>

            <div className="mt-6 bg-white p-4 rounded-2xl shadow">
              <h3 className="font-semibold">Trade Analyzer (Demo)</h3>
              <p className="mt-2 text-sm text-slate-600">Select players you would give and players you would receive, then run the analysis. Results are based on current community scores (demo logic).</p>

              <div className="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                  <div className="text-xs text-slate-500">Pick players you GIVE (select multiple)</div>
                  <div className="mt-2 grid gap-2">
                    {players.map(p=> (
                      <button key={p.id} onClick={()=>toggleSelect(setGiveSelection, giveSelection, p.id)} className={`text-left p-2 rounded border ${giveSelection.includes(p.id)&&'bg-rose-50 border-rose-300'}`}>
                        <div className="font-medium">{p.name}</div>
                        <div className="text-xs text-slate-500">{p.pos} — {p.team}</div>
                      </button>
                    ))}
                  </div>
                </div>

                <div>
                  <div className="text-xs text-slate-500">Pick players you RECEIVE (select multiple)</div>
                  <div className="mt-2 grid gap-2">
                    {players.map(p=> (
                      <button key={p.id} onClick={()=>toggleSelect(setReceiveSelection, receiveSelection, p.id)} className={`text-left p-2 rounded border ${receiveSelection.includes(p.id)&&'bg-emerald-50 border-emerald-300'}`}>
                        <div className="font-medium">{p.name}</div>
                        <div className="text-xs text-slate-500">{p.pos} — {p.team}</div>
                      </button>
                    ))}
                  </div>
                </div>
              </div>

              <div className="mt-4 flex gap-2">
                <button onClick={runAnalysis} className="px-4 py-2 rounded bg-emerald-600 text-white">Run Analysis</button>
                <button onClick={()=>{ setGiveSelection([]); setReceiveSelection([]); setAnalysisResult(null); setMessage(''); }} className="px-4 py-2 rounded border">Clear</button>
              </div>

              {analysisResult && (
                <div className="mt-4 bg-slate-50 p-3 rounded">
                  <div className="text-sm">Give total score: <strong>{analysisResult.giveScore}</strong></div>
                  <div className="text-sm">Receive total score: <strong>{analysisResult.recvScore}</strong></div>
                  <div className="text-sm mt-2">Verdict: <strong>{analysisResult.verdict}</strong></div>
                  <div className="text-xs text-slate-500 mt-1">Tip: This demo uses a simple community-score sum. In production we recommend normalizing for positional value, roster construction, and including confidence intervals.</div>
                </div>
              )}
            </div>

          </div>

          <aside className="bg-white rounded-2xl p-4 shadow-sm h-fit">
            <h4 className="font-semibold">Why contribute?</h4>
            <ul className="mt-2 text-sm list-disc list-inside text-slate-700">
              <li>Help build living, up-to-date values based on real managers.</li>
              <li>Get free access — community-grown data shouldn't be locked behind paywalls.</li>
              <li>Win more trades by exploiting mismatches between your valuation and the community's.</li>
            </ul>

            <div className="mt-4">
              <h5 className="font-semibold">Developer notes</h5>
              <p className="text-xs text-slate-500 mt-2">To make this production-ready: persist KTCs to a database, build auth (OAuth), rate-limit submissions, and implement a more robust aggregation algorithm (e.g., Bradley-Terry or TrueSkill). Also add player search, images, and league-level customization.</p>
            </div>

            <div className="mt-6 text-sm text-slate-500">Contact: hello@pigskinprophets.example</div>
          </aside>
        </section>

        <section className="mt-12 text-xs text-slate-500">
          <div>Demo notes: All calculations here are local and illustrative. Replace local state with API calls to scale.</div>
        </section>

      </main>

      <footer className="border-t bg-white mt-12">
        <div className="max-w-6xl mx-auto px-4 py-6 text-sm text-slate-600">© {new Date().getFullYear()} PigSkinProphets — community trade values (demo)</div>
      </footer>
    </div>
  );
}
